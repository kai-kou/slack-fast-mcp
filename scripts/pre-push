#!/bin/bash
# pre-push hook - push å‰ã«å“è³ªã‚²ãƒ¼ãƒˆã‚’è‡ªå‹•å®Ÿè¡Œ
#
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•:
#   make setup-hooks
#   ã¾ãŸã¯: cp scripts/pre-push .git/hooks/pre-push && chmod +x .git/hooks/pre-push
#
# ã‚¹ã‚­ãƒƒãƒ—æ–¹æ³•ï¼ˆç·Šæ€¥æ™‚ã®ã¿ï¼‰:
#   git push --no-verify

set -euo pipefail

echo ""
echo "ğŸ” Pre-push quality gate running..."
echo ""

# Makefile ã® quality ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’å®Ÿè¡Œ
if make quality; then
    echo ""
    echo "âœ… Quality gate passed. Pushing..."
    echo ""
    exit 0
else
    echo ""
    echo "âŒ Quality gate FAILED. Push rejected."
    echo ""
    echo "Fix the issues above, then try again."
    echo "To skip (NOT recommended): git push --no-verify"
    echo ""
    exit 1
fi
