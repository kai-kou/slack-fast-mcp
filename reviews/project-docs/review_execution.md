# レビュー結果: ③ 実行設計（How）

**レビュアー**: 実行設計レビュアー
**対象ドキュメント**: requirements.md / architecture.md / slack-app-setup.md
**レビュー日**: 2026-02-10

---

## 総合評価: B（実行可能だが、実装時の具体性に課題）

設計の方向性は妥当で実装可能な水準にあるが、**実装に着手した際に判断に迷うグレーゾーン**がいくつか存在する。特に、エッジケースの処理とコンテキスト（context.Context）の取り扱いに関する詳細が不足。

---

## 1. 実装可能性の検証

### 1.1 コンポーネント別実装難易度

| コンポーネント | 難易度 | 見積もり工数 | 懸念事項 |
|---|---|---|---|
| Config Layer | 低 | 0.5日 | 環境変数展開の正規表現処理が主要タスク |
| Slack Client | 中 | 1.5日 | インターフェース設計は明確。チャンネル名解決のページネーションが追加工数 |
| MCP Server | 低 | 1日 | mcp-go のAPIに沿った実装。ツール定義のサンプルコードが充実 |
| CLI Layer | 中 | 1.5日 | cobra のサブコマンド実装は定型的だが、setup ウィザードの対話UI設計が未詳細 |
| ビルド・CI/CD | 低 | 0.5日 | GoReleaser + GitHub Actions は定番構成 |
| テスト | 中 | 1.5日 | モック実装 + テストケース設計 |
| **合計** | - | **約6.5日** | - |

### 1.2 実装上の具体的課題

| # | 指摘 | 重要度 | 説明 |
|---|---|---|---|
| E-1 | **setupコマンドの対話UIが未設計** | 高 | requirements.md §5.2 で「対話形式でSlack App作成手順を案内」とあるが、具体的な対話フロー（どんな質問をどの順序で？入力バリデーションは？）が未定義。実装者が独自判断で作ることになり、品質のばらつきが出る |
| E-2 | **context.Context の利用方針が不明確** | 中 | architecture.md の SlackClient インターフェースは `context.Context` を受け取るが、タイムアウト値やキャンセレーション方針が未定義。MCP Server モードでのリクエストタイムアウトは何秒？ |
| E-3 | **エラーコードの一覧が分散** | 中 | requirements.md の各ツール仕様にエラーケースが散在しており、architecture.md の AppError.Code と1:1でマッピングされていない。実装時にどのコードを使うべきか判断しにくい |
| E-4 | **ログライブラリの選定が不在** | 中 | requirements.md §8 でログ方針は定義されているが、使用するログライブラリ（標準log？slog？zerolog？）が未選定。architecture.md の技術スタックにも記載なし |
| E-5 | **`slack_get_history` の `oldest`/`latest` パラメータのMCPツール側バリデーション** | 低 | Unix timestamp 文字列の形式チェック（数値文字列か、小数点ありか等）の仕様が未記述 |

---

## 2. リソースと依存関係

### 2.1 外部依存のリスク

| 依存 | リスク | 対策状況 |
|---|---|---|
| mcp-go v0.43.2 | v1未到達、APIの破壊的変更の可能性 | △ リスク認識はあるが対策なし |
| slack-go/slack v0.17.3 | v1未到達（requirements.md §10.2 で言及） | △ 同上 |
| cobra v1.8 | 安定版、リスク低 | ◎ |
| Slack API | レート制限変更、仕様変更のリスク | ○ レート制限は言及あり |

### 2.2 指摘事項

| # | 指摘 | 重要度 | 説明 |
|---|---|---|---|
| E-6 | **go.mod の最小Goバージョンの根拠不足** | 低 | architecture.md で「Go 1.23+」としているが、1.23を要求する具体的な理由（使用する言語機能等）が未記述 |
| E-7 | **mcp-go のバージョンピン戦略が不在** | 中 | `v0.43.2+` としているが、破壊的変更のリスクを考慮すると、特定バージョンにピンするか、メジャーバージョン内で追従するかの方針が必要 |

---

## 3. タイムラインと優先順位

### 3.1 指摘事項

| # | 指摘 | 重要度 | 説明 |
|---|---|---|---|
| E-8 | **開発順序（実装順）の未定義** | 高 | どのコンポーネントから着手すべきかの優先順位が未定義。推奨: Config → Slack Client → MCP Server → CLI → CI/CD → テスト の順で、各段階で動作確認可能にする |
| E-9 | **MVPの定義が不在** | 高 | 最小限の動作（例: post_messageだけ動く状態）を定義し、早期にフィードバックループを回すべき。全機能を一度に実装するアプローチはリスクが高い |
| E-10 | **テストの実装タイミングが不明** | 中 | テスト戦略（requirements.md §9）は定義されているが、TDDで進めるのか、後からテストを追加するのかが不明 |

---

## 4. 実装のグレーゾーン（判断が必要な箇所）

以下は、現在のドキュメントでは判断できず、実装時に追加の意思決定が必要な箇所:

| # | 項目 | 選択肢 | 推奨 |
|---|---|---|---|
| G-1 | チャンネル未指定 & デフォルト未設定時の挙動 | エラー返却 vs 全チャンネル一覧表示 | エラー返却（「default_channelを設定するかchannelパラメータを指定してください」） |
| G-2 | トークン未設定時のMCP Server起動 | 起動拒否 vs 起動してツール実行時にエラー | 起動拒否（早期失敗の原則） |
| G-3 | `conversations.list` でチャンネルが見つからない場合 | 即エラー vs 全ページ検索後にエラー | 全ページ検索後にエラー（ただし上限設定） |
| G-4 | MCP ツールの結果JSONのエンコーディング | 日本語をエスケープする vs UTF-8そのまま | UTF-8そのまま（LLMが読みやすい） |
| G-5 | CLIの `--json` フラグ未指定時のデフォルト出力形式 | テーブル形式 vs プレーンテキスト | テーブル形式（視認性重視） |

---

## 5. 推奨アクション（優先度順）

1. **【高】E-8, E-9: 開発フェーズとMVP定義の追加** — MVP: Config + Slack Client（PostMessage） + MCP Server（slack_post_message）で最小動作
2. **【高】E-1: setup コマンドの対話フロー設計** — 質問リスト、入力バリデーション、エラー時の再入力フローを定義
3. **【中】E-2: context.Context の利用方針追加** — MCP リクエストタイムアウト: 30秒、CLI: 10秒 を推奨
4. **【中】E-3: エラーコード一覧の一元化** — requirements.md にエラーコードマスターテーブルを作成
5. **【中】E-4: ログライブラリの選定** — Go 1.21+ の標準 `log/slog` を推奨（外部依存なし、構造化ログ対応）
6. **【低】E-5, E-6: バリデーション仕様の追記**
