# ③ 実行設計レビュー: 環境変数の永続化手順追記

**レビュー日**: 2026-02-10
**レビュー対象**: README.md, README_ja.md, docs/slack-app-setup.md, docs/architecture.md
**レビュー範囲**: E-03指摘対応（環境変数の永続化手順追記）

---

## 評価サマリー

| 観点 | 評価 | コメント |
|---|---|---|
| 実行可能性 | ⭕ 良好 | 手順がコピペ可能で、初見ユーザーでも完走可能 |
| OS別対応 | ⭕ 良好 | macOS/Linux/Windows の3OS対応 |
| 手順の具体性 | ⭕ 良好 | 4ステップに分解、各ステップにコマンド例付き |
| タイムライン適切性 | ⭕ 良好 | 修正範囲が適切に限定されている |

**総合評価: A（良好）**

---

## 詳細レビュー

### E-E01: 4ステップガイドの完成度 ✅

Setup Guide §5.1 の4ステップ構成は実務的に優れている:

1. **シェル確認** (`echo $SHELL`) — 前提条件の確認
2. **プロファイル追記** — 具体的なファイル名とコマンド
3. **設定反映** (`source`) — 即座に反映する方法
4. **設定確認** (`echo $SLACK_BOT_TOKEN`) — 成功の検証

この「確認→実行→反映→検証」のサイクルは**初見ユーザーが迷わないための理想的な構成**。特にステップ4の確認手順は、多くのセットアップガイドで省略されがちだが、ここに含まれている点が良い。

### E-E02: コマンド例の実行安全性 ✅

```bash
echo "export SLACK_BOT_TOKEN='xoxb-your-token-here'" >> ~/.zprofile
```

`>>` (追記) を使用しているため、既存の `.zprofile` を破壊しない。ただし、**同じコマンドを複数回実行すると重複行が追記される**点は注意が必要。

**現状の対応**: Setup Guide では「エディタで直接編集しても、以下のコマンドで追記しても OK」と選択肢を提示しており、十分な配慮がなされている。

### E-E03: `source` コマンドの OS 分岐 ✅

```bash
source ~/.zprofile    # macOS (zsh) の場合
source ~/.bash_profile  # Linux (bash) の場合
```

OS別の分岐が明示されている点は良い。ただし、**Windows の場合は `source` が使えない**ため、「PowerShell を再起動してください」という案内が必要だが、これは `<details>` 内の Windows セクションで対応済み。

### E-E04: セキュリティ注意事項の実効性 ⚠️ 中

Setup Guide §5.1 の末尾:
> トークンをシェルプロファイルに記述する場合、ファイルのパーミッションが適切であることを確認してください（`chmod 600 ~/.zprofile`）。

**問題**: `chmod 600 ~/.zprofile` は**パーミッションが厳しすぎる**可能性がある。

- `~/.zprofile` のデフォルトパーミッションは通常 `644` (`rw-r--r--`)
- `600` に変更すると、他のユーザーからの読み取りが不可になる（個人PCでは影響なし）
- ただし、共有サーバー環境では適切

**推奨**: 「必要に応じて」の前置きを追加するか、具体的にどのような環境で必要かを補足する。

```
> **セキュリティ上の注意:** 共有サーバーなどマルチユーザー環境でトークンをシェルプロファイルに記述する場合、ファイルのパーミッションを確認してください（`chmod 600 ~/.zprofile`）。
```

### E-E05: dotfiles リポジトリへの注意喚起 ✅

> dotfiles リポジトリで管理している場合はトークンが含まれないよう注意してください。

この注意喚起は実務的に非常に有用。dotfiles を GitHub に公開しているユーザーがトークンを含むプロファイルをpushしてしまう事故は実際に発生する。

### E-E06: README のBlockquote表現力 ✅

README §3 の `> Important` ブロック内に、テーブル・コマンド例・リンクを含めている。GitHub Markdown のBlockquote内では:
- テーブル: ✅ レンダリングされる
- コードブロック: ✅ レンダリングされる
- リンク: ✅ 機能する

ただし、**一部のMarkdownパーサー（Obsidian等）ではBlockquote内のテーブルが正しくレンダリングされない**場合がある。GitHub上での表示を主要ターゲットとしているため、問題は軽微。

### E-E07: `SLACK_DEFAULT_CHANNEL` の永続化 ✅

環境変数の永続化例で `SLACK_BOT_TOKEN` だけでなく `SLACK_DEFAULT_CHANNEL` も含めている点は良い。これにより、ユーザーは必要な環境変数を一度に設定できる。

---

## 指摘一覧

| ID | 重要度 | 内容 | 対象ファイル |
|---|---|---|---|
| E-E01 | — | 4ステップ構成は優秀。問題なし | — |
| E-E02 | — | コマンドの安全性は適切。問題なし | — |
| E-E03 | — | OS分岐は対応済み。問題なし | — |
| E-E04 | 中 | `chmod 600` の適用条件を限定する表現にする | docs/slack-app-setup.md |
| E-E05 | — | dotfiles 注意喚起は有用。問題なし | — |
| E-E06 | 低 | Blockquote 内テーブルの互換性（GitHub以外） | README.md, README_ja.md |
| E-E07 | — | `SLACK_DEFAULT_CHANNEL` の併記は良好 | — |
